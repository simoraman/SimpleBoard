@{
    ViewBag.Title = "SimpleBoard";
}

<h2>Index</h2>
<div id="container">
    <div id="board">
        <div id="todo" class="board-col" >
            <h3>ToDo</h3>
            <div data-bind="foreach: {data:todoTasks, afterRender:makeDraggable}">
                <form class="item" data-bind="submit: function(form){viewModel.updateItem($data)}">
                    <span data-bind="text:Id"></span>
                    <br />
                    <span data-bind="text: Description"></span>
                    <input type="hidden" data-bind="text: Status" /> 
                </form>
            </div>
        </div>
        <div id="doing" class="board-col">
            <h3>Doing</h3>
            <div data-bind="foreach: {data:doingTasks, afterRender:makeDraggable}">
                <div class="item"><span data-bind="text: Description"></span></div>
            </div>
        </div>
        <div id="done" class="board-col">
            <h3>Done</h3>
            <div data-bind="foreach: {data:doneTasks, afterRender:makeDraggable}">
                <div class="item"><span data-bind="text: Description"></span></div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="~/Scripts/App/taskViewModel.js" type="text/javascript"></script>
    <script type="text/javascript">
        var viewModel;
        $(function () {
            viewModel = new taskViewModel();
            ko.applyBindings(viewModel);

            viewModel.load();

            $(".board-col").droppable({
                hoverClass: "column-state-hover",
                drop: function (event, ui) {
//                    alert(this.id);
                    ui.draggable.submit();
                }
            });
        });

        function makeDraggable() {
            $('.item').draggable({ revert: "invalid" });
        }
    </script>
}