@{
    ViewBag.Title = "SimpleBoard";
}

<h2>@ViewBag.Title</h2>
<div id="container">
    <div id="board">
        <div id="ToDo" class="board-col" >
            <h3>ToDo</h3>
            <div data-bind="foreach: {data:tasks, afterRender:makeDraggable}">
                <!-- ko if: $data.Status.toUpperCase()==='ToDo'.toUpperCase() -->
                @Html.Partial("_Card")
                <!-- /ko -->
            </div>
        </div>
        <div id="Doing" class="board-col">
            <h3>Doing</h3>
            <div data-bind="foreach: {data:tasks, afterRender:makeDraggable}">
                <!-- ko if: $data.Status.toUpperCase()==='Doing'.toUpperCase() -->
                @Html.Partial("_Card")
                <!-- /ko -->
            </div>
        </div>
        <div id="Done" class="board-col">
            <h3>Done</h3>
            <div data-bind="foreach: {data:tasks, afterRender:makeDraggable}">
                 <!-- ko if: $data.Status.toUpperCase()==='done'.toUpperCase() -->
                @Html.Partial("_Card")
                <!-- /ko -->
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="~/Scripts/App/taskViewModel.js" type="text/javascript"></script>
    <script type="text/javascript">
        var viewModel;
        $(function () {
            viewModel = new taskViewModel();
            ko.applyBindings(viewModel);

            viewModel.load();

            $(".board-col").droppable({
                hoverClass: "column-state-hover",
                drop: function (event, ui) {
                    ui.draggable.find('input').val(this.id).change();
                    ui.draggable.submit();
                }
            });
        });

        function makeDraggable() {
            $('.item').draggable({ revert: "invalid" });
        }
    </script>
}